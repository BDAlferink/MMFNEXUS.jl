<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · MMFNEXUS.jl</title><meta name="title" content="Tutorial · MMFNEXUS.jl"/><meta property="og:title" content="Tutorial · MMFNEXUS.jl"/><meta property="twitter:title" content="Tutorial · MMFNEXUS.jl"/><meta name="description" content="Documentation for MMFNEXUS.jl."/><meta property="og:description" content="Documentation for MMFNEXUS.jl."/><meta property="twitter:description" content="Documentation for MMFNEXUS.jl."/><meta property="og:url" content="https://BDAlferink.github.io/MMFNEXUS.jl/tutorial/"/><meta property="twitter:url" content="https://BDAlferink.github.io/MMFNEXUS.jl/tutorial/"/><link rel="canonical" href="https://BDAlferink.github.io/MMFNEXUS.jl/tutorial/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MMFNEXUS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../theory/">Theory</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Options"><span>Options</span></a></li><li><a class="tocitem" href="#Multithreading"><span>Multithreading</span></a></li></ul></li><li><a class="tocitem" href="../citations/">citations</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/BDAlferink/MMFNEXUS.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/BDAlferink/MMFNEXUS.jl/blob/main/docs/src/tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>In this tutorial, we demonstrate how to use MMF NEXUS on a density field. The density field used in this example is obtained from using <a href="https://github.com/jfeldbrugge/PhaseSpaceDTFE.jl">Phase Space DTFE</a> on the particle distributino of a 64^3 GADGET-4 simulation. </p><p>In principle MMF NEXUS can be applied to any continous density field. Due to the filtering in log space, NEXUS+ requires the field to be positive valued everywhere. We suggest to use <a href="https://github.com/MariusCautun/DTFE">DTFE</a> or <a href="https://github.com/jfeldbrugge/PhaseSpaceDTFE.jl">Phase Space DTFE</a> for the density field reconstructions as those methods preserve the geometric properties of the matter distribution and are positive valued at each point.</p><p>We now start by importing relevant libraries and loading the data. We plot a slice of the density field to illustrate what we are working with.</p><pre><code class="language-julia hljs">using MMFNEXUS, HDF5, Statistics, Plots

# Load test density field
function load_data(file)
    fid = h5open(file, &quot;r&quot;)
    densityfield = read(fid[&quot;densityfield&quot;])
    close(fid)

    densityfield = densityfield ./ mean(densityfield)
    return densityfield
end

densityfield = load_data(&quot;assets/data/densityfield.h5&quot;);
heatmap(log10.(densityfield[:, :, 20]), aspect_ratio=:equal, c=:viridis, title=&quot;Density Field Slice&quot;, xlabel=&quot;x [Mpc/h]&quot;, ylabel=&quot;y [Mpc/h]&quot;, colorbar_title=&quot;log₁₀(1+δ)&quot;, xlims=(0, 50), ylims=(0, 50), xticks=0:10:50, yticks=0:10:50);</code></pre><img src="d517bb8a.svg" alt="Example block output"/><p>We now set up the simulation box and a number of parameters used in nexus. These are fairly standard but can be changed. Particularly the minimum filtering scale can be changed according to the resolution of the simulation and according density field.</p><pre><code class="language-julia hljs"># set up the box
N = 64 # number of voxels per side
L = 50. # side length in Mpc/h
M = 4.075e10 * 64^3 # total mass contained in the box in in Msun

# set NEXUS+ parameters
min_scale = 1. #minimum smoothing scale in Mpc/h
filter_scales = 4 #max n in min_scale*(√2)^n, starting at n=0
density_contrast_node = 370.
min_node_mass = 1e13 # minimum mass of a node in Msun/h
min_fila_volume = 10 # minimum volume of a filament in (Mpc/h)^3
min_wall_volume = 10 # minimum volume of a wall in (Mpc/h)^3
nothing</code></pre><p>The NEXUS+ routine is called with the function <code>NEXUS_Plus</code>, which takes the density field and the above parameters as inputs. The final parameter is a verbose level which can be set to <code>none</code>, <code>info</code>, or <code>debug</code>. <code>info</code> gives some basic information on what the calulation is doing. <code>debug</code> gives additional information and figures of the threshold calulation to see what is going on. <code>NEXUS_Plus</code> gives four boolean matrices where for each environemt a <code>1</code> means the voxel is considered to be in the corresponding environemnt</p><pre><code class="language-julia hljs">MMF_node, MMF_fila, MMF_wall, MMF_void = NEXUS_Plus(densityfield, N,
L, M, filter_scales, density_contrast_node, min_node_mass, min_fila_volume, min_wall_volume; R0 = min_scale, level = :info);
nothing</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Starting node signature calculation...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 1.0
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 1.414
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 2.0
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 2.828
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 4.0
<span class="sgr36"><span class="sgr1">[ Info: </span></span>
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Starting node identification...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Optimal node signature threshold: 6.333
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Number of identified nodes: 48
<span class="sgr36"><span class="sgr1">[ Info: </span></span>
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Starting filament and wall signature calculation...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 1.0
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 1.414
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 2.0
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 2.828
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing scale R = 4.0
<span class="sgr36"><span class="sgr1">[ Info: </span></span>
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Starting filament identification...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Optimal filament signature threshold: 0.107
<span class="sgr36"><span class="sgr1">[ Info: </span></span>
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Starting wall identification...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Optimal wall signature threshold: 0.286
<span class="sgr36"><span class="sgr1">[ Info: </span></span>
<span class="sgr36"><span class="sgr1">[ Info: </span></span>NEXUS+ identification finished</code></pre><p>We can use the result to plot the contours on top of the slice of a density field, which we show below, or any subsequent analysis.</p><pre><code class="language-julia hljs">slice_index = 20
heatmap(log10.(densityfield[:, :, slice_index]), aspect_ratio=:equal, c=:viridis, title=&quot;Density Field Slice&quot;, xlabel=&quot;x [Mpc/h]&quot;, ylabel=&quot;y [Mpc/h]&quot;, colorbar_title=&quot;log₁₀(1+δ)&quot;, xlims=(0, 50), ylims=(0, 50), xticks=0:10:50, yticks=0:10:50)
contour!(MMF_wall[:, :, slice_index], levels=[0.5], color=:green, linewidth=2, label=&quot;Walls&quot;)
contour!(MMF_fila[:, :, slice_index], levels=[0.5], color=:blue, linewidth=2, label=&quot;Filaments&quot;)
contour!(MMF_node[:, :, slice_index], levels=[0.5], color=:red, linewidth=2, label=&quot;Nodes&quot;)</code></pre><img src="011e2a41.svg" alt="Example block output"/><h2 id="Options"><a class="docs-heading-anchor" href="#Options">Options</a><a id="Options-1"></a><a class="docs-heading-anchor-permalink" href="#Options" title="Permalink"></a></h2><p>Explain other options, maybe individual functions? maybe debug?</p><h2 id="Multithreading"><a class="docs-heading-anchor" href="#Multithreading">Multithreading</a><a id="Multithreading-1"></a><a class="docs-heading-anchor-permalink" href="#Multithreading" title="Permalink"></a></h2><p>Multithreading is <code>automatically</code> enabled. It will utalize the cores available to your instance of Julia. This can be set by opening julia with a specifified number of threads:</p><pre><code class="language-bash hljs">$ julia --threads 4</code></pre><p>to open julia with 4 threads for example or by setting an environment variable. For more information, see the corresponding <a href="https://docs.julialang.org/en/v1/manual/multi-threading/">multi-threading documentation</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../theory/">« Theory</a><a class="docs-footer-nextpage" href="../citations/">citations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 19 February 2026 09:30">Thursday 19 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
